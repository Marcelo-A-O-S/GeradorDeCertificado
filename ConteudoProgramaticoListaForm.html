<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.3/css/dataTables.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/autofill/2.7.0/css/autoFill.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous">
    </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
    integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous">
    </script>
  <script src="https://cdn.datatables.net/2.3.3/js/dataTables.min.js" crossorigin="anonymous">
  </script>
  <script src="https://cdn.datatables.net/autofill/2.7.0/js/dataTables.autoFill.min.js"
    crossorigin="anonymous"></script>
</head>

<body>
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto">Atividade em andamento...</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div id="toast-body" class="toast-body">
      </div>
    </div>
  </div>
  <main class="">
    <div class="d-flex justify-content-start ">
      <button type="button" class="btn btn-primary" onclick="CadastrarConteudoProgramatico()">Cadastrar Conteúdo
        Programatico</button>
    </div>
    <table class="display nowrap" id="table">
      <thead>
        <tr>
          <th scope="col">Id </th>
          <th scope="col">Id Curso</th>
          <th scope="col">Curso</th>
          <th scope="col">Conteúdo</th>
          <th scope="col">Carga horária</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
    </table>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous">
    </script>
  <script>
    var toastBody = document.getElementById('toast-body');
    const toastLiveExample = document.getElementById('liveToast');
    const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample);
    let datatable = new DataTable('#table', {
      scrollCollapse: true,
      scroller: true,
      scrollY: 200,
      scrollX: true
    });
    function CarregarDataTable(conteudosProgramaticos) {
      conteudosProgramaticos = CarregarLista(conteudosProgramaticos)
      datatable.clear();
      datatable.rows.add(conteudosProgramaticos);
      datatable.draw();
    }
    function CarregarLista(conteudosProgramaticos) {
      return conteudosProgramaticos.map(conteudoProgramatico => [
        conteudoProgramatico.Id,
        conteudoProgramatico.IdCursoTurma,
        conteudoProgramatico.CursoTurma,
        conteudoProgramatico.Conteudo,
        conteudoProgramatico.CargaHoraria,
        `<button class="btn btn-danger btn-sm" onclick="EditarConteudoProgramatico(${conteudoProgramatico.Id})">Editar</button>
          <button class="btn btn-primary btn-sm" onclick="DeletarConteudoProgramatico(${conteudoProgramatico.Id})">Deletar</button>`
      ]);
    }
    function CadastrarConteudoProgramatico() {
      toastBootstrap.show();
      toastBody.textContent = "Adicionando conteúdo programático..."
      google.script.run.withSuccessHandler(function () {
      }).FormCadastrarConteudoProgramatico()
    }
    function EditarConteudoProgramatico(IdConteudoProgramatico) {
      toastBootstrap.show()
      toastBody.textContent = `Editando conteúdo programático...`
      google.script.run.withSuccessHandler(function (retorno) {
        toastBody.textContent = retorno;
        google.script.run.withSuccessHandler(function (conteudosProgramaticos) {
          conteudosProgramaticos = JSON.parse(conteudosProgramaticos);
          CarregarDataTable(conteudosProgramaticos)
        }).BuscarConteudosProgramaticos()
      }).FormCadastrarConteudoProgramatico(IdConteudoProgramatico)
    }
    function DeletarConteudoProgramatico(IdConteudoProgramatico) {
      toastBootstrap.show()
      toastBody.textContent = `Deletando conteúdo programático...`
      google.script.run.withSuccessHandler(function (retorno) {
        toastBody.textContent = retorno;
        google.script.run.withSuccessHandler(function (conteudosProgramaticos) {
          conteudosProgramaticos = JSON.parse(conteudosProgramaticos);
          CarregarDataTable(conteudosProgramaticos)
        }).BuscarConteudosProgramaticos()
      }).DeletarConteudoProgramatico(IdConteudoProgramatico)
    }
    document.addEventListener("DOMContentLoaded", () => {
      google.script.run.withSuccessHandler(function (conteudosProgramaticos) {
        conteudosProgramaticos = JSON.parse(conteudosProgramaticos);
        CarregarDataTable(conteudosProgramaticos)
      }).BuscarConteudosProgramaticos()
    })
  </script>
</body>

</html>