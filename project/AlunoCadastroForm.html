<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous">
    </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
    integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous">
    </script>

</head>

<body>
   <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto">Atividade em andamento...</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div id="toast-body" class="toast-body">
      </div>
    </div>
  </div>
  <main class="container">
    <form id="CadastroForm">
      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Id</label>
        <input type="text" class="form-control" id="IdAluno" disabled>
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Nome do Aluno</label>
        <input type="text" class="form-control" id="Nome" placeholder="Informe o nome..." required>
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Email</label>
        <input type="email" class="form-control" id="Email" placeholder="name@example.com" required>
      </div>
      <div class="row mb-3">
        <div class="col">
          <label for="exampleFormControlInput1" class="form-label">CPF</label>
          <input type="text" class="form-control"  id="Cpf" maxlength="14" placeholder="Exemplo:999.999.999-99" required>
        </div>
        <div class="col">
          <label for="exampleFormControlInput1" class="form-label">Whatsapp</label>
          <input type="text" class="form-control" id="Whatsapp" maxlength="11" placeholder="Exemplo:99999999999" required>
        </div>
        <div class="col">
          <label for="exampleFormControlInput1" class="form-label">Gênero</label>
          <select class="form-select" id="Genero" aria-label="Default select example">
            <option value="" selected>Selecione o gênero</option>
            <option value="Masculino">Masculino</option>
            <option value="Feminino">Feminino</option>
          </select>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-primary" >Salvar</button>
      </div>

    </form>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous">
    </script>
  <script>
    var toastBody = document.getElementById('toast-body');
    const toastLiveExample = document.getElementById('liveToast');
    const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample);
    document.getElementById("CadastroForm").addEventListener('submit', (e) => {
      e.preventDefault();
      toastBootstrap.show()
      toastBody.textContent = `Salvando aluno...`
      SalvarAluno();
    })
    function SalvarAluno() {
      var aluno = {};
      var selects = document.querySelectorAll(".form-select")
      var inputs = document.querySelectorAll(".form-control");
      inputs.forEach((item) => {
        aluno[item.id] = item.value
      });
      selects.forEach((item)=>{
        aluno[item.id] = item.value
      })
      aluno = JSON.stringify(aluno)
      google.script.run.withSuccessHandler(function (retorno) {
        toastBody.textContent = retorno;
        google.script.run.withSuccessHandler().FormListarAluno();
      }).SalvarAluno(aluno)
    }
    document.addEventListener("DOMContentLoaded", () => {
      if (document.getElementById("AlunoEdit") != null) {
        var alunoEdit = document.getElementById("AlunoEdit").innerText;
        alunoEdit = parseInt(alunoEdit);
        google.script.run.withSuccessHandler(function (aluno) {
          aluno = JSON.parse(aluno)
          for (const [key, value] of Object.entries(aluno)) {
            document.getElementById(key).value = value;
          }
        }).BuscarAluno(alunoEdit)
      }
    })
  </script>
</body>

</html>